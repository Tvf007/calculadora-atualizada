<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Caixa Aberto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      padding: 15px;
      font-size: 1.2em;
      background-color: #28a745;
      color: white;
      margin-bottom: 10px;
    }
    .container {
      display: flex;
      flex-direction: row;
      flex-grow: 1;
      gap: 15px;
      padding: 10px;
      overflow: hidden;
    }
    .col-esquerda,
    .col-direita {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
      overflow-y: auto;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .col-esquerda,
      .col-direita {
        height: auto;
        margin-bottom: 15px;
      }
    }
    .produto {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    label {
      font-size: 14px;
      flex: 2;
    }
    input[type="text"] {
      width: 60px;
      padding: 6px;
      font-size: 16px;
      border: 1px solid #ccc;
      outline: none;
      text-align: right;
    }
    .preco {
      font-size: 14px;
      color: green;
      flex: 1;
      text-align: right;
    }

    .rodape {
      position: sticky;
      bottom: 0;
      background: #fff;
      padding: 15px;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 999;
    }

    .rodape div {
      flex: 1;
      text-align: center;
      font-size: 14px;
    }

    .rodape button {
      flex: 2;
      padding: 12px;
      font-size: 16px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .rodape button:hover {
      background-color: #218838;
    }

    /* Teclado Virtual */
    .teclado-numerico {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: #f9f9f9;
      border-top: 1px solid #ccc;
      padding: 10px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .teclado-numerico h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 16px;
    }

    .teclado-numerico button {
      width: 28%;
      height: 40px;
      margin: 4px 1%;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #aaa;
      border-radius: 5px;
      background-color: #fff;
    }

    .teclado-numerico button.enter {
      background-color: #28a745;
      color: white;
    }

    .teclado-numerico button.backspace {
      background-color: #dc3545;
      color: white;
    }

    ul {
      list-style-type: none;
      padding-left: 0;
    }

    li {
      margin: 4px 0;
      padding: 6px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    #mensagemValidacao {
      color: red;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>

<h1>Caixa Aberto</h1>

<div class="container">
  <!-- Coluna Esquerda -->
  <div class="col-esquerda">
    <div class="produto">
      <label for="quantidadePaoFrances">PÃO FRANCÊS:</label>
      <input type="text" id="quantidadePaoFrances" onclick="abrirTeclado(this)" readonly>
      <span class="preco">R$ 0,70</span>
    </div>
    <div class="produto">
      <label for="quantidadePaoDoceComum">PÃO COMUM:</label>
      <input type="text" id="quantidadePaoDoceComum" onclick="abrirTeclado(this)" readonly>
      <span class="preco">R$ 0,70</span>
    </div>
    <div class="produto">
      <label for="quantidadePaoDoceEspecial">PÃO DOCE ESPECIAL:</label>
      <input type="text" id="quantidadePaoDoceEspecial" onclick="abrirTeclado(this)" readonly>
      <span class="preco">R$ 0,80</span>
    </div>
    <div class="produto">
      <label for="valorEntrada">OUTRO PRODUTO (R$):</label>
      <input type="text" id="valorEntrada" placeholder="Digite valor" onclick="abrirTeclado(this)" readonly>
      <span id="resultadoAcumulado">R$ 0,00</span>
    </div>
  </div>

  <!-- Coluna Direita -->
  <div class="col-direita">
    <div id="notaFiscal">
      <h2>Resumo</h2>
      <ul id="listaItens"></ul>
    </div>
    <div id="historicoNotas"></div>
  </div>
</div>

<!-- Rodapé com Total, Recebido, Troco e Botão -->
<div class="rodape">
  <div><strong>Total:</strong><br><span id="valorTotal">R$ 0,00</span></div>
  <div><strong>Recebido:</strong><br><input type="text" id="valorRecebido" onclick="abrirTeclado(this)" readonly></div>
  <div><strong>Troco:</strong><br><span id="valorTroco">R$ 0,00</span></div>
  <button onclick="proximoCliente()">Finalizar Venda</button>
</div>

<!-- Teclado Numérico -->
<div class="teclado-numerico" id="tecladoNumerico">
  <h3>Teclado Virtual</h3>
  <div id="botoesTeclado" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>
</div>

<script>
  const botoes = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '.', '0', '⌫', 'Enter'];
  const botoesDiv = document.getElementById('botoesTeclado');
  botoes.forEach(btn => {
    const b = document.createElement('button');
    b.textContent = btn;
    if (btn === 'Enter') b.classList.add('enter');
    else if (btn === '⌫') b.classList.add('backspace');
    b.onclick = () => digitarTeclado(btn);
    botoesDiv.appendChild(b);
  });

  let numeroNota = 1;
  let historico = [];
  let totalAcumulado = 0;
  let produtosAdicionais = [];
  let campoFocado = null;

  function formatar(valor) {
    return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  }

  function atualizarNota(nome, qtd, valorUnitario, subtotal) {
    const lista = document.getElementById('listaItens');
    const id = `item-${nome.toLowerCase().replace(/\s+/g, '-')}`;
    if (qtd <= 0) {
      const existente = document.getElementById(id);
      if (existente) lista.removeChild(existente);
      return;
    }
    const linha = `${nome} x${qtd} = ${formatar(subtotal)} (${formatar(valorUnitario)})`;
    let li = document.getElementById(id);
    if (!li) {
      li = document.createElement('li');
      li.id = id;
      lista.appendChild(li);
    }
    li.textContent = linha;
  }

  function criarCalculadora(inputId, resultadoId, precoUnitario, nomeProduto) {
    const input = document.getElementById(inputId);
    const resultado = document.getElementById(resultadoId);
    function calcular() {
      let qtd = parseInt(input.value) || 0;
      let subtotal = qtd * precoUnitario;
      resultado.textContent = formatar(subtotal);
      atualizarNota(nomeProduto, qtd, precoUnitario, subtotal);
      atualizarTotalGeral();
    }
    input.addEventListener('input', calcular);
    calcular(); // Calcula inicial
  }

  criarCalculadora('quantidadePaoFrances', 'resultadoPaoFrances', 0.70, 'Pão Francês');
  criarCalculadora('quantidadePaoDoceComum', 'resultadoPaoDoceComum', 0.70, 'Pão Doce Comum');
  criarCalculadora('quantidadePaoDoceEspecial', 'resultadoPaoDoceEspecial', 0.80, 'Pão Doce Especial');

  function abrirTeclado(campo) {
    campoFocado = campo;
  }

  function digitarTeclado(valor) {
    if (campoFocado) {
      if (valor === 'Enter') {
        if (campoFocado.id === 'valorEntrada') adicionarOutroProduto();
        else if (campoFocado.id === 'valorRecebido') atualizarTroco();
        return;
      } else if (valor === '⌫') {
        limparCampo();
        return;
      }
      campoFocado.value += valor;
      const event = new Event('input', { bubbles: true });
      campoFocado.dispatchEvent(event);

      if (campoFocado.id === 'valorRecebido') {
        atualizarTroco();
      }
    }
  }

  function limparCampo() {
    if (campoFocado) {
      campoFocado.value = '';
      const event = new Event('input', { bubbles: true });
      campoFocado.dispatchEvent(event);
    }
  }

  function fecharTeclado() {
    document.getElementById('tecladoNumerico').style.display = 'block';
    if (campoFocado) campoFocado.blur();
    campoFocado = null;
  }

  function adicionarOutroProduto() {
    let valorTexto = document.getElementById('valorEntrada').value.replace(',', '.');
    let valor = parseFloat(valorTexto);
    if (!isNaN(valor) && valor > 0) {
      const nome = 'Outro Produto';
      const id = `item-outrosprodutos-${produtosAdicionais.length + 1}`;
      const novoItem = { id: id, texto: `${nome} - ${formatar(valor)}` };
      produtosAdicionais.push(novoItem);
      totalAcumulado += valor;
      const li = document.createElement('li');
      li.id = id;
      li.textContent = novoItem.texto;
      document.getElementById('listaItens').appendChild(li);
      document.getElementById('resultadoAcumulado').textContent = formatar(totalAcumulado);
      document.getElementById('valorEntrada').value = '';
      atualizarTotalGeral();
    }
  }

  function atualizarTotalGeral() {
    const paoFrances = parseInt(document.getElementById('quantidadePaoFrances').value) || 0;
    const paoDoceComum = parseInt(document.getElementById('quantidadePaoDoceComum').value) || 0;
    const paoDoceEspecial = parseInt(document.getElementById('quantidadePaoDoceEspecial').value) || 0;
    const total =
      paoFrances * 0.70 +
      paoDoceComum * 0.70 +
      paoDoceEspecial * 0.80 +
      totalAcumulado;
    document.getElementById('valorTotal').textContent = formatar(total);
    document.getElementById('nfTotal').textContent = formatar(total);
    atualizarTroco();
  }

  function atualizarTroco() {
    const total = parseFloat(document.getElementById('valorTotal').textContent.replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
    const recebidoTexto = document.getElementById('valorRecebido').value.trim().replace(',', '.');
    const recebido = parseFloat(recebidoTexto) || 0;
    const troco = recebido - total;
    document.getElementById('valorTroco').textContent = troco >= 0 ? formatar(troco) : 'Falta pagar';
    document.getElementById('nfRecebido').textContent = formatar(recebido);
    document.getElementById('nfTroco').textContent = troco >= 0 ? formatar(troco) : 'Falta pagar';
  }

  function proximoCliente() {
    const total = parseFloat(document.getElementById('valorTotal').textContent.replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
    const recebidoTexto = document.getElementById('valorRecebido').value.trim().replace(',', '.');
    const recebido = parseFloat(recebidoTexto) || 0;
    const msgElemento = document.getElementById('mensagemValidacao');
    if (recebidoTexto === '') {
      alert('Falta preencher valor recebido');
      return;
    }
    if (recebido < total) {
      alert('Valor insuficiente');
      return;
    }

    const itens = Array.from(document.getElementById('listaItens').children).map(li => li.textContent);
    const data = new Date().toLocaleString();
    historico.push({
      numero: numeroNota++,
      itens,
      total: document.getElementById('nfTotal').textContent,
      recebido: document.getElementById('nfRecebido').textContent,
      troco: document.getElementById('nfTroco').textContent,
      data
    });

    // Limpa dados
    document.getElementById('quantidadePaoFrances').value = '';
    document.getElementById('quantidadePaoDoceComum').value = '';
    document.getElementById('quantidadePaoDoceEspecial').value = '';
    document.getElementById('valorEntrada').value = '';
    document.getElementById('resultadoAcumulado').textContent = 'R$ 0,00';
    document.getElementById('listaItens').innerHTML = '';
    document.getElementById('valorTotal').textContent = 'R$ 0,00';
    document.getElementById('valorRecebido').value = '';
    document.getElementById('valorTroco').textContent = 'R$ 0,00';
    totalAcumulado = 0;
    produtosAdicionais = [];
    renderizarHistorico();
  }

  function renderizarHistorico() {
    const container = document.getElementById('historicoNotas');
    container.innerHTML = '<h2>Histórico</h2>';
    historico.slice(-3).reverse().forEach(nota => {
      const div = document.createElement('div');
      div.className = 'nota-item';
      div.innerHTML = `
        <div><strong>Resumo #${nota.numero}</strong> - ${nota.data}</div>
        <ul>${nota.itens.map(item => `<li>${item}</li>`).join('')}</ul>
        <div>Total: ${nota.total}</div>
        <div>Recebido: ${nota.recebido}</div>
        <div>Troco: ${nota.troco}</div>
      `;
      container.appendChild(div);
    });
  }

  window.onload = () => {
    document.querySelectorAll("input[type='text']").forEach(input => {
      input.setAttribute("readonly", true);
      input.addEventListener("focus", () => abrirTeclado(input));
    });
    document.getElementById('tecladoNumerico').style.display = 'block';
  };
</script>
</body>
</html>
